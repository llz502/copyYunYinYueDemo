<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<link rel="stylesheet" href="./css/reset.css">
<link rel="stylesheet" href="./css/player.css">
<body>
    <div class="playerWrapper">
        <section class="play">
            <div class="diskcoverWrapper">
                <div class="diskcover">
                    <div class="img">
                        <img src="./src/jpg/America2China.jpg" alt="">
                    </div>
                    <div class="playBtn"></div>
                    <div class="pauseBtn"></div>
                </div>
            </div>
            <div class="lyrics">
                <h2>
                    <strong>America 2 China -</strong>
                    南征北战/Raz-B/Rick Ross
                </h2>
                <ul>
                    <li class="active">作曲 : Raz-B</li>
                    <li>作词 : Raz-B/南征北战/Rick Ross</li>
                    <li>Record label: DJ Central Records</li>
                </ul>
            </div>
        </section>
        <div class="domain">
            <div class="btn open">打 开</div>
            <div class="btn down active">下 载</div>
        </div>
        <script src="./lib/zepto.min.js"></script>
        <script src="./lib/av-min.js"></script>
        <script>
            window.onload = function(){

                (function(){
                    function getParameterByName(name, url) {
                    if (!url) url = window.location.href;
                    name = name.replace(/[\[\]]/g, "\\$&");
                    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                        results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                    }

                    var id = getParameterByName('id');
                    console.log('id',id)
                    var query = new AV.Query('Playlist');
                    query.get(id).then(function (song) {
                    var {url, lyric} = song.attributes
                    console.log('url',url)
                    console.log('lyric',lyric)
                    // let video = document.createElement('video')
                    // video.src = url
                    // video.play()
                    // let array = []
                    // let parts = lyric.split('\n')
                    // parts.forEach(function(string,index){
                    //     let xxx = string.split(']')
                    //     xxx[0] = xxx[0].substring(1)
                    //     let regex = /(\d+):([\d.]+)/
                    //     let matches = xxx[0].match(regex)
                    //     let minute = +matches[1]
                    //     let seconds = +matches[2]
                    //     array.push({
                    //     time: minute*60+seconds,
                    //     lyric: xxx[1]
                    //     })
                    // })
                    // setInterval(function(){
                    //     let current = video.currentTime
                    //     for(let i=0;i<array.length;i++){
                    //     if(i === array.length - 1){
                    //         console.log(array[i].lyric)
                    //     }else if(array[i].time <= current && array[i+1].time > current){
                    //         console.log(array[i].lyric)
                    //         break;
                    //     }
                    //     }
                    // },500)
                    })

                })()
            }

        </script>
    </div>
</body>
</html>